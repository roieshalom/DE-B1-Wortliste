<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <title>B1-WortschatzÃœbung</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Google Fonts Noto Sans -->
  <link href="https://fonts.googleapis.com/css?family=Noto+Sans:400,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="themes/main.css">
  <link rel="stylesheet" href="themes/light.css">
  <link rel="stylesheet" href="themes/brutalist.css">
</head>
<body>
  <div class="theme-bar">
    <button class="theme-btn theme-btn-default" onclick="setTheme('light')">
      Default
    </button>
    <button class="theme-btn theme-btn-brutalist" onclick="setTheme('brutalist')">
      Brutalist
    </button>
  </div>

  <div class="header">
    <div class="header-inner">
      <h1 class="app-title">B1-WortschatzÃœbung</h1>
      <div class="header-links">
        <a href="#statistiken">Statistiken</a>
        <!-- give the Ãœber link an id so JS can hook it -->
        <a href="#ueber" id="about-link">Ãœber</a>
      </div>
    </div>
  </div>

  <div class="main-layout">
    <div id="game-container"></div>
    <button id="next-btn">Next</button>
  </div>

  <!-- ABOUT MODAL -->
  <div class="about-modal-overlay" id="about-overlay">
    <div class="about-modal" id="about-modal">
      <div class="about-modal-header">
        <h2 class="about-modal-title">
          Ãœber
          <span>
            <button
              type="button"
              class="about-modal-lang-btn active"
              id="about-lang-de"
              aria-label="Deutsch"
            >ðŸ‡©ðŸ‡ª</button>
            <button
              type="button"
              class="about-modal-lang-btn"
              id="about-lang-en"
              aria-label="English"
            >ðŸ‡¬ðŸ‡§</button>
          </span>
        </h2>
        <button class="about-modal-close" id="about-close-btn" aria-label="SchlieÃŸen">&times;</button>
      </div>

      <div class="about-modal-body">
        <p id="about-text-de">
          <span style="font-weight:600;">
            Diese Seite hilft dir, den gesamten wichtigen Wortschatz der offiziellen Goethe-B1-Wortliste zu lernen.
          </span>
          <br><br>
          Diese Seite ist ein kleines Ãœbungswerkzeug, um den deutschen Wortschatz auf B1-Niveau aufzubauen.
          Die Wortliste basiert auf der offiziellen Goethe-B1-Wortliste und enthÃ¤lt nur Vokabeln auf diesem Niveau.
          Du kannst die Karten umdrehen, dir zu jedem deutschen Wort die englische Ãœbersetzung ansehen und mit dem Next Button in deinem eigenen Tempo weiterlernen.
          Es gibt keine Accounts, keine Anmeldung und die Nutzung ist kostenlos.
          Es kÃ¶nnen einfache, anonyme Nutzungsdaten (zum Beispiel Anzahl der Besucher und Sitzungen)
          erfasst werden, um zu sehen, ob die Seite noch verwendet wird.
          Es werden keine personenbezogenen Daten gespeichert oder weitergegeben,
          und es besteht keine Verbindung zum Goethe-Institut oder zu anderen offiziellen PrÃ¼fungsanbietern.
        </p>

        <p id="about-text-en" style="display:none;">
          <span style="font-weight:600;">
            This site helps you learn all key vocabulary from the official Goethe B1 word list.
          </span>
          <br><br>
          This site is a small practice tool for building German vocabulary at the B1 level. 
          It is based on the official Goethe B1 word list and focuses only on words from that level.
          You can flip through the cards, see each German word with its English translation,
          and move on with the Next button at your own pace. There are no accounts, no logins, and the tool is free to use.
          Basic, anonymous usage data (for example number of visitors and sessions) may be collected to understand whether people are still using the site.
          No personal data is stored or shared, and there is no connection to Goethe-Institut or any other official exam provider.    
        </p>
      </div>

      <div class="about-modal-bottom">
        <a
          href="mailto:fragen@fragen-katalog.com"
          class="about-modal-email"
        >
          fragen@fragen-katalog.com
        </a>

        <!-- Support button placeholder -->
        <button type="button" class="support-button-placeholder">
          UnterstÃ¼tzen
        </button>
      </div>
    </div>
  </div>

  <script>
    // Keys from JSON
    const WORD_KEY = "Wortliste";
    const MEANING_KEY = "Meaning";
    const ENGLISH_KEY = "English";
    let vocabData = [];
    let currentIdx = 0;
    
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }
    
    function adjustOuterHeight(outer, front, back) {
      setTimeout(() => {
        const frontHeight = front.scrollHeight;
        const backHeight = back.scrollHeight;
        const maxHeight = Math.max(frontHeight, backHeight, 180);
        outer.style.minHeight = maxHeight + "px";
      }, 0);
    }
    
    function renderCard(idx) {
      const container = document.getElementById('game-container');
      container.innerHTML = ""; // Clear previous card
      
      const item = vocabData[idx];
      if (!item) {
        container.innerHTML = "<p>No card found.</p>";
        return;
      }
      
      const word = item[WORD_KEY] || Object.values(item)[0];
      const meaning = item[MEANING_KEY] || "";
      const english = item[ENGLISH_KEY] || "";
      
      const outer = document.createElement('div');
      outer.className = 'flip-card-outer';
      
      const card = document.createElement('div');
      card.className = 'flip-card';
      card.innerHTML = `
        <div class="flip-card-inner">
          <div class="flip-card-front">${word}</div>
          <div class="flip-card-back">
            <div class="back-english">${english}</div>
            <div class="back-meaning">${meaning}</div>
          </div>
        </div>
      `;
      
      // Flip on click
      card.addEventListener('click', function() {
        card.classList.toggle('flipped');
        const front = card.querySelector('.flip-card-front');
        const back = card.querySelector('.flip-card-back');
        adjustOuterHeight(outer, front, back);
      });
      
      outer.appendChild(card);
      container.appendChild(outer);
      
      // Adjust height after render
      const front = card.querySelector('.flip-card-front');
      const back = card.querySelector('.flip-card-back');
      adjustOuterHeight(outer, front, back);
    }
    
    function showCard(idx) {
      if (vocabData.length === 0) return;
      if (idx < 0) idx = 0;
      if (idx >= vocabData.length) idx = 0;
      currentIdx = idx;
      renderCard(currentIdx);
    }
    
    fetch('csvjson.json')
      .then(response => response.json())
      .then(data => {
        vocabData = data;
        shuffleArray(vocabData);
        showCard(0);
      })
      .catch(error => {
        document.getElementById('game-container').innerText =
          'Fehler beim Laden der Wortliste: ' + error;
      });
    
    document.getElementById('next-btn').addEventListener('click', function() {
      if (vocabData.length > 0) {
        currentIdx = (currentIdx + 1) % vocabData.length;
        showCard(currentIdx);
      }
    });

    // THEME SWITCHER (data-theme only, CSS variables in themes/main.css)
    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
    }

    document.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('theme') || 'light';
      setTheme(savedTheme);

      // ABOUT MODAL JS
      const aboutLink = document.getElementById('about-link');
      const aboutOverlay = document.getElementById('about-overlay');
      const aboutModal = document.getElementById('about-modal');
      const aboutCloseBtn = document.getElementById('about-close-btn');
      const langDeBtn = document.getElementById('about-lang-de');
      const langEnBtn = document.getElementById('about-lang-en');
      const textDe = document.getElementById('about-text-de');
      const textEn = document.getElementById('about-text-en');

      function openAbout() {
        aboutOverlay.classList.add('open');
      }

      function closeAbout() {
        aboutOverlay.classList.remove('open');
      }

      aboutLink.addEventListener('click', function(e) {
        e.preventDefault();
        openAbout();
      });

      aboutCloseBtn.addEventListener('click', closeAbout);

      aboutOverlay.addEventListener('click', function(e) {
        if (e.target === aboutOverlay) {
          closeAbout();
        }
      });

      langDeBtn.addEventListener('click', () => {
        langDeBtn.classList.add('active');
        langEnBtn.classList.remove('active');
        textDe.style.display = 'block';
        textEn.style.display = 'none';
      });

      langEnBtn.addEventListener('click', () => {
        langEnBtn.classList.add('active');
        langDeBtn.classList.remove('active');
        textDe.style.display = 'none';
        textEn.style.display = 'block';
      });
    });
  </script>
</body>
</html>
